<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Cervantino Map — Time Filter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<style>
  html, body { height: 100%; margin: 0; }
  #map { height: calc(100% - 90px); }
  .toolbar {
    display: flex; gap: 12px; align-items: center;
    padding: 10px 12px; border-bottom: 1px solid #eee; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .pill { padding: 6px 10px; border: 1px solid #ddd; border-radius: 999px; }
  .legend-dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; background:#3388ff; }
  .counter { font-weight: 600; }
</style>
</head>
<body>
  <div class="toolbar">
    <div><strong>Cervantino — Filter by time</strong></div>
    <label class="pill">Time: <input type="time" id="timePicker" value="12:00"></label>
    <label class="pill">Category:
      <select id="categorySelect">
        <option value="">All</option>
      </select>
    </label>
    <span class="pill"><span class="legend-dot"></span><span class="counter" id="visibleCount">0</span> visible</span>
    <a class="pill" href="cervantino_clean.csv" download>Download CSV</a>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script>
    // Embedded data
    const data = [{"Category": "Teatro", "Event": "Neo Artic", "Venue": "Auditorio del Estado", "TicketRequired": "Sí", "PriceRange": "$640-$1200", "Latitude": 21.012995723533, "Longitude": -101.274450210991, "Available From": "12:00", "Available To": "13:30", "URL": "https://festivalcervantino.gob.mx/actividad/1280/neoarctic"}, {"Category": "Música", "Event": "Voces Distantes (Cello)", "Venue": "Templo del Señor Santiago Apostol en Márfil", "TicketRequired": "Sí", "PriceRange": "$410-$580", "Latitude": 21.0023631506226, "Longitude": -101.28275550542, "Available From": "13:30", "Available To": "14:30", "URL": "https://festivalcervantino.gob.mx/actividad/1236/voces-distantes-siempre-presentes"}, {"Category": "Danza", "Event": "Ballet - Giselle ", "Venue": "Teatro Principal", "TicketRequired": "Sí", "PriceRange": "Ya no hay", "Latitude": 21.0157655834594, "Longitude": -101.251703786645, "Available From": "18:00", "Available To": "19:30", "URL": "https://festivalcervantino.gob.mx/actividad/1310/em-giselle-las-que-no-volvieron-em"}, {"Category": "Teatro", "Event": "Neo Artic", "Venue": "Auditorio del Estado", "TicketRequired": "Sí", "PriceRange": "$640-$1200", "Latitude": 21.012995723533, "Longitude": -101.274450210991, "Available From": "20:00", "Available To": "21:30", "URL": "https://festivalcervantino.gob.mx/actividad/1280/neoarctic"}, {"Category": "Música", "Event": "Nati Pelusa", "Venue": "Parque Los Pastitos", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0172707942713, "Longitude": -101.263770665991, "Available From": "22:00", "Available To": "23:00", "URL": "https://festivalcervantino.gob.mx/actividad/1249/grasa-tour"}, {"Category": "Pintura", "Event": "Diego Rivera Exposición", "Venue": "Museo Casa Diego Rivera", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0182628795647, "Longitude": -101.255135700056, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1427/diego-rivera-formas-de-su-imaginario"}, {"Category": "Pintura", "Event": "Diego Rivera 2: Ahora es personal", "Venue": "Museo Casa Diego Rivera", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0182628795647, "Longitude": -101.255135700056, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1428/diego-rivera-y-su-relacion-con-veracruz"}, {"Category": "Pintura", "Event": "Kahlo Sin Fronteras", "Venue": "Museo Casa Diego Rivera", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0182628795647, "Longitude": -101.255135700056, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1433/kahlo-sin-fronteras"}, {"Category": "Exposición Arte", "Event": "Rumores de la noche", "Venue": "Museo Casa Diego Rivera", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0182628795647, "Longitude": -101.255135700056, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1434/rumores-de-la-noche-elisa-malo"}, {"Category": "Música", "Event": "El Bajío se tiñe de Huapango", "Venue": "Ex. Hda. San Gabriel de Barrer\n", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0110011095807, "Longitude": -101.271144270817, "Available From": "12:00", "Available To": "13:00", "URL": "https://festivalcervantino.gob.mx/actividad/1245/el-bajio-se-tine-de-huapango"}, {"Category": "Cine", "Event": "La Laguna Rosa", "Venue": "Antiguo Patio del Hospicio de la Santísima Trinidad", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0172276963877, "Longitude": -101.252926300177, "Available From": "12:00", "Available To": "13:30", "URL": "https://festivalcervantino.gob.mx/actividad/1361/la-laguna-rosa-2022"}, {"Category": "Exposición Arte", "Event": "La mayólica de Gorky González", "Venue": "Museo del Pueblo de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0171645612071, "Longitude": -101.253899960325, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1435/la-mayolica-de-gorky-gonzalez-una-tradicion-que-vive"}, {"Category": "Exposición Cerámica", "Event": "Dolores Porras. Taller de cerámica", "Venue": "Museo del Pueblo de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0171645612071, "Longitude": -101.253899960325, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1436/dolores-porras-taller-de-ceramica"}, {"Category": "Exposición Arte", "Event": "Grandes Maestros del Arte Popular de Guanajuato y Veracruz", "Venue": "Museo del Pueblo de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0171645612071, "Longitude": -101.253899960325, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1437/dialogo-entre-los-grandes-maestros-del-arte-popular-de-guanajuato-y-veracruz"}, {"Category": "Escultura", "Event": "Kiyoto Ota, Gaia", "Venue": "Museo Palacio de los Poderes", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0171921350203, "Longitude": -101.254722086517, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1439/kiyoto-ota-gaia"}, {"Category": "Documental", "Event": "Ensayo para un baile de gala. Cosa Rapozo & Hernán González", "Venue": "Museo Palacio de los Poderes", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0171921350203, "Longitude": -101.254722086517, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1440/ensayo-para-un-baile-de-gala-cosa-rapozo-hernan-gonzalez"}, {"Category": "Escultura", "Event": "Florecer en piedra: viento, olas y pétalos. Japón y la escultura veracruzana", "Venue": "Museo Conde Rul", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0170818063321, "Longitude": -101.25449603523, "Available From": "10:00", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1441/florecer-en-piedra-viento-olas-y-petalos-japon-y-la-escultura-veracruzana"}, {"Category": "Exposición Foto", "Event": "Cosechando Alientos Robados. San Gil", "Venue": "Museo Conde Rul", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0170818063321, "Longitude": -101.25449603523, "Available From": "10:00", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1442/cosechando-alientos-robados-san-gil"}, {"Category": "Exposición Arte ", "Event": "Casa Muestra", "Venue": "Museo de Arte e Historia de Guanajuato", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 21.1164617953281, "Longitude": -101.659850977746, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1446/casa-muestra"}, {"Category": "Escultura", "Event": "Sueños escultóricos en una noche de Verano", "Venue": "Museo de Arte e Historia de Guanajuato", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 21.1164617953281, "Longitude": -101.659850977746, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1447/suenos-escultoricos-en-una-noche-de-verano"}, {"Category": "Exposición Arte", "Event": "Estampación contemporánea México y Japón", "Venue": "Museo de Arte e Historia de Guanajuato", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 21.1164617953281, "Longitude": -101.659850977746, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1448/estampacion-contemporanea-mexico-y-japon"}, {"Category": "Exposición Arte", "Event": "¿Cuántos filamentos de niebla desteje la memoria mientras duerme?", "Venue": "Museo de Arte e Historia de Guanajuato", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 21.1164617953281, "Longitude": -101.659850977746, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1449/cuantos-filamentos-de-niebla-desteje-la-memoria-mientras-duerme"}, {"Category": "Exposición Arte", "Event": "Religiosidad popular. Los exvotos en el Bajío", "Venue": "Museo Hermenegildo Bustos", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 21.0288036333096, "Longitude": -101.877972835108, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1450/religiosidad-popular-los-exvotos-en-el-bajio"}, {"Category": "Pintura", "Event": "Entre la línea y el cielo: Tributo a Joy Laville", "Venue": "Centro de las Artes Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 20.5675062219715, "Longitude": -101.197830067713, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1452/entre-la-linea-y-el-cielo-tributo-a-joy-laville"}, {"Category": "Exposición Foto", "Event": "Byron Brauchli: Recorridos", "Venue": "Museo Alhóndiga de Granaditas", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "85", "Latitude": 21.0188833545803, "Longitude": -101.257789709306, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1453/byron-brauchli-recorridos"}, {"Category": "Exposición Cerámica", "Event": "Bajo el fuego y sobre la tierra. Cerámica contemporánea desde Veracruz", "Venue": "Museo Alhóndiga de Granaditas", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "85", "Latitude": 21.0188833545803, "Longitude": -101.257789709306, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1454/bajo-el-fuego-y-sobre-la-tierra-ceramica-contemporanea-desde-veracruz"}, {"Category": "Exposición Foto", "Event": "Sin Ítaca que aguarde", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1456/sin-itaca-que-aguarde"}, {"Category": "Exposición Foto", "Event": "Morbid Angel", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1457/morbid-angel"}, {"Category": "Exposición Foto", "Event": "Archivo de la desobediencia", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1458/archivo-de-la-desobediencia"}, {"Category": "Exposición Arte", "Event": "Ilustres Carteles Xalapeños", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1460/ilustres-carteles-xalapenos"}, {"Category": "Exposición Arte", "Event": "A la hora del té. Estampas sobre cuentos ingleses", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1461/a-la-hora-del-te-estampas-sobre-cuentos-ingleses"}, {"Category": "Exposición Arte", "Event": "Colección Orquesta Sinfónica de Xalapa / 95 aniversario", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "06:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1462/coleccion-orquesta-sinfonica-de-xalapa-95-aniversario"}, {"Category": "Pintura", "Event": "El tiempo y la obra. Retrospectiva de José Dolores Aguilera", "Venue": "Museo Salvador Almaraz", "TicketRequired": "No", "PriceRange": "", "Latitude": 20.6741977082982, "Longitude": -101.350017060786, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1471/el-tiempo-y-la-obra-retrospectiva-de-jose-dolores-aguilera"}, {"Category": "Exposición Arte", "Event": "Sueños y metáforas. Colección Pago en Especie y Acervo Patrimonial de la SHCP", "Venue": "Museo de Arte Octavio Ocampo", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "27", "Latitude": 20.5233036986424, "Longitude": -100.813350756052, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1472/suenos-y-metaforas-coleccion-pago-en-especie-y-acervo-patrimonial-de-la-shcp"}, {"Category": "Exposición Foto", "Event": "Las letanías de la sequía. Obra de Antonio Luquín", "Venue": "Museo de Arte Octavio Ocampo", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "27", "Latitude": 20.5233036986424, "Longitude": -100.813350756052, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1473/las-letanias-de-la-sequia-obra-de-antonio-luquin"}, {"Category": "Exposición Antigüedades", "Event": "Veracruz en siete tiempos. Una revisión a la Bienal de Arte Veracruz", "Venue": "Museo José y Tomás Chávez Morado", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "25", "Latitude": 20.9446481684873, "Longitude": -101.428782279004, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1445/veracruz-en-siete-tiempos-una-revision-a-la-bienal-de-arte-veracruz"}, {"Category": "Pintura", "Event": "Miguel Cabrera. Pintor de la Virgen María", "Venue": "Galería Mariana", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0165573108624, "Longitude": -101.253417714066, "Available From": "10:00", "Available To": "15:00", "URL": "https://festivalcervantino.gob.mx/actividad/1444/miguel-cabrera-pintor-de-la-virgen-maria"}, {"Category": "Música", "Event": "Tambor Fantasma: El Libro de Huesos", "Venue": "Templo de la Compañía de Jesús Oratorio de San Felipe Neri", "TicketRequired": "Sí", "PriceRange": "$230-$330", "Latitude": 21.0174401899992, "Longitude": -101.252396604011, "Available From": "17:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1258/el-libro-de-los-huesos"}, {"Category": "Danza", "Event": "Onírico Danza-Teatro del Gesto", "Venue": "Teatro Cervantes", "TicketRequired": "Sí", "PriceRange": "$150-$380", "Latitude": 21.0133239673087, "Longitude": -101.250481870207, "Available From": "17:00", "Available To": "18:30", "URL": "https://festivalcervantino.gob.mx/actividad/1273/errantes-viaje-a-la-memoria"}, {"Category": "Teatro", "Event": "Proyecto Ruelas | Compañía de Teatro Comunitario de San Ignacio", "Venue": "Plaza San Roque", "TicketRequired": "No", "PriceRange": "", "Latitude": 20.6573607390987, "Longitude": -101.342520179245, "Available From": "17:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1287/cierra-los-ojos-y-entonces-imagina"}, {"Category": "Cine", "Event": "Teat Monteok. El cuento del dios del Rayo (1985)", "Venue": "Antiguo Patio del Hospicio de la Santísima Trinidad", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0172637506571, "Longitude": -101.252987987596, "Available From": "17:00", "Available To": "17:30", "URL": "https://festivalcervantino.gob.mx/actividad/1344/teat-monteok-el-cuento-del-dios-del-rayo-1985"}, {"Category": "Cine", "Event": "A Través de Tola (2023)", "Venue": "Antiguo Patio del Hospicio de la Santísima Trinidad", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0172637506571, "Longitude": -101.252987987596, "Available From": "17:00", "Available To": "18:30", "URL": "https://festivalcervantino.gob.mx/actividad/1345/a-traves-de-tola-2023"}, {"Category": "Música", "Event": "Reeps One", "Venue": "Explanada de la Alhóndiga de Granaditas", "TicketRequired": "Sí", "PriceRange": "$170-$280", "Latitude": 21.0191704395952, "Longitude": -101.258549722271, "Available From": "20:00", "Available To": "21:00", "URL": "https://festivalcervantino.gob.mx/actividad/1254/reeps-one"}, {"Category": "Teatro", "Event": "Ménage à trois: Bienvenidx al Kabarett", "Venue": "Catacumbas Mesón de San Antonio", "TicketRequired": "Sí", "PriceRange": "170", "Latitude": 21.0159095038655, "Longitude": -101.254047522055, "Available From": "20:00", "Available To": "21:30", "URL": "https://festivalcervantino.gob.mx/actividad/1313/menage-a-trois-bienvenidx-al-kabarett"}, {"Category": "Conferencia Cine", "Event": "2016, el año de la crisis (2019) *Charla al término de la función con Gustavo Vega", "Venue": "Universidad de Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0173552566714, "Longitude": -101.252919995495, "Available From": "20:00", "Available To": "22:00", "URL": "https://festivalcervantino.gob.mx/actividad/1316/2016-el-ano-de-la-crisis-2019-charla-al-termino-de-la-funcion-con-gustavo-vega"}, {"Category": "Conferencia Música", "Event": "Breaking the waves de Missy Mazzol", "Venue": "Teatro Juárez", "TicketRequired": "Sí", "PriceRange": "$100-$900", "Latitude": 21.0154246622089, "Longitude": -101.252935442332, "Available From": "20:00", "Available To": "20:30", "URL": "https://festivalcervantino.gob.mx/actividad/1419/breaking-the-waves-de-missy-mazzoli"}, {"Category": "Ópera", "Event": "Estudio de la Ópera de Bellas Artes y Orquesta Juvenil Universitaria Eduardo Mata de la UNAM", "Venue": "Teatro Juárez", "TicketRequired": "Sí", "PriceRange": "$100-$900", "Latitude": 21.0154246622089, "Longitude": -101.252935442332, "Available From": "21:00", "Available To": "23:00", "URL": "https://festivalcervantino.gob.mx/actividad/1250/breaking-the-waves-de-missy-mazzoli"}, {"Category": "Música", "Event": "Felipe Riveros Trío: Sesión Palo Quemado", "Venue": "El Trasnoche", "TicketRequired": "Sí", "PriceRange": "$250-$360", "Latitude": 21.0090669426226, "Longitude": -101.273342634795, "Available From": "23:00", "Available To": "23:59", "URL": "https://festivalcervantino.gob.mx/actividad/1240/sesion-palo-quemado"}, {"Category": "Pintura", "Event": "La restauración del espíritu. Obra gráfica de Eliseo Mijango", "Venue": "Centro de las Artes Guanajuato", "TicketRequired": "No", "PriceRange": "", "Latitude": 20.5675062219715, "Longitude": -101.197830067713, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1451/la-restauracion-del-espiritu-obra-grafica-de-eliseo-mijangos"}, {"Category": "Pintura", "Event": "El Bloque: Shakespeare", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1463/el-bloque-shakespeare"}, {"Category": "Exposición Arte", "Event": "De lo Figurativo a lo Abstracto", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1464/de-lo-figurativo-a-lo-abstracto"}, {"Category": "Mural", "Event": "Capilla Cervantina de lanza y plum", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1465/capilla-cervantina-de-lanza-y-pluma"}, {"Category": "Exposición Arte", "Event": "Objetos de indagación. Flor Bosco", "Venue": "Teatro Manuel Doblado", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "10", "Latitude": 21.1229811620494, "Longitude": -101.680080763559, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1467/objetos-de-indagacion-flor-bosco"}, {"Category": "Exposición Naturaleza", "Event": "Daisies, Emilies and Lilies. Azucena Germán", "Venue": "Teatro María Grever", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.1239118268577, "Longitude": -101.682842652262, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1468/daisies-emilies-and-lilies-azucena-german"}, {"Category": "Exposición de Institución", "Event": "Gráfica bajo La Ceiba. 20 años de arte comunitario y sustentable", "Venue": "Museo de la Universidad de Guanajuato", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0158344355256, "Longitude": -101.252120662653, "Available From": "10:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1455/grafica-bajo-la-ceiba-20-anos-de-arte-comunitario-y-sustentable"}, {"Category": "Exposición Arte", "Event": "Neo Tamemes. Chavis Mármol", "Venue": "Casa de la Cultura Diego Rivera", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.1232396738515, "Longitude": -101.683018090712, "Available From": "11:00", "Available To": "18:00", "URL": "https://festivalcervantino.gob.mx/actividad/1470/neo-tamemes-chavis-marmol"}, {"Category": "Exposición Textiles", "Event": "Veracruz: Mapas de hilo y color", "Venue": "Teatro Cervantes", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0133239673087, "Longitude": -101.250481870207, "Available From": "08:00", "Available To": "21:00", "URL": "https://festivalcervantino.gob.mx/actividad/1494/veracruz-mapas-de-hilo-y-color"}, {"Category": "Pintura", "Event": "Tres perspectivas desde México José García Ocejo-Chuck Plosky-Mauricio Benítez", "Venue": "Foro Cultural 81", "TicketRequired": "No", "PriceRange": "", "Latitude": 21.0185805991054, "Longitude": -101.256463376504, "Available From": "10:00", "Available To": "17:00", "URL": "https://festivalcervantino.gob.mx/actividad/1495/tres-perspectivas-desde-mexico-jose-garcia-ocejo-chuck-plosky-mauricio-benitez"}, {"Category": "Pintura", "Event": "Al sur del viento", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1496/al-sur-del-viento"}, {"Category": "Reflexión sobre humanos e IA", "Event": "Mucho ruido y pocas nueces", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1497/much-ado-about-nothing-br-mucho-ruido-y-pocas-nueces"}, {"Category": "Exposición Foto", "Event": "60a Edición de la Fotografía de Vida Silvestre del Año", "Venue": "Museo Iconográfico del Quijote", "TicketRequired": "Sí pero es la entrada del museo y todas las expos juntas", "PriceRange": "30", "Latitude": 21.0144529331442, "Longitude": -101.252067831729, "Available From": "09:30", "Available To": "19:00", "URL": "https://festivalcervantino.gob.mx/actividad/1497/much-ado-about-nothing-br-mucho-ruido-y-pocas-nueces"}];
    // Build category list
    const categories = Array.from(new Set(data.map(d => d.Category).filter(Boolean))).sort();
    const catSel = document.getElementById('categorySelect');
    for (const c of categories) {
      const opt = document.createElement('option');
      opt.value = c; opt.textContent = c;
      catSel.appendChild(opt);
    }

    const map = L.map('map');
    const lats = data.map(d => +d.Latitude);
    const lngs = data.map(d => +d.Longitude);
    const avgLat = lats.reduce((a,b)=>a+b,0) / lats.length;
    const avgLng = lngs.reduce((a,b)=>a+b,0) / lngs.length;
    map.setView([avgLat, avgLng], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const cluster = L.markerClusterGroup();
    map.addLayer(cluster);

    const markers = [];

    function toMinutes(hhmm) {
      if (!hhmm) return null;
      const [h,m] = hhmm.split(':').map(x=>parseInt(x,10));
      return h*60 + m;
    }

    function within(time, start, end) {
      if (time == null || start == null || end == null) return false;
      return start <= time && time <= end;
    }

    function makePopup(d) {
      const price = d.PriceRange ? `<div><strong>Precio:</strong> ${d.PriceRange}</div>` : '';
      const ticket = d.TicketRequired ? `<div><strong>Boleto:</strong> ${d.TicketRequired}</div>` : '';
      const url = d.URL ? `<div><a href="${d.URL}" target="_blank" rel="noopener">Más info</a></div>` : '';
      return `
        <div style="min-width:220px">
          <div><strong>${d.Event}</strong></div>
          <div>${d.Venue}</div>
          <div>${d.Category}</div>
          <div><strong>${d['Available From']}</strong>–<strong>${d['Available To']}</strong></div>
          ${price}
          ${ticket}
          ${url}
        </div>
      `;
    }

    for (const d of data) {
      const m = L.marker([+d.Latitude, +d.Longitude]);
      m._meta = {
        start: toMinutes(d['Available From']),
        end: toMinutes(d['Available To']),
        cat: d.Category || '',
        raw: d
      };
      m.bindPopup(makePopup(d));
      markers.push(m);
      cluster.addLayer(m);
    }

    function applyFilters() {
      const tVal = document.getElementById('timePicker').value || '12:00';
      const time = toMinutes(tVal);
      const cat = catSel.value;

      let visible = 0;
      for (const m of markers) {
        const okTime = within(time, m._meta.start, m._meta.end);
        const okCat = !cat || m._meta.cat === cat;
        const show = okTime && okCat;
        if (show) {
          cluster.addLayer(m);
          visible += 1;
        } else {
          cluster.removeLayer(m);
        }
      }
      document.getElementById('visibleCount').textContent = visible;

      if (visible > 0) {
        const group = L.featureGroup(markers.filter(m => cluster.hasLayer(m)));
        map.fitBounds(group.getBounds().pad(0.2));
      } else {
        map.setView([avgLat, avgLng], 14);
      }
    }

    document.getElementById('timePicker').addEventListener('change', applyFilters);
    document.getElementById('categorySelect').addEventListener('change', applyFilters);
    applyFilters();
  </script>
</body>
</html>
